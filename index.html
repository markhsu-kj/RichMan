<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‡´å¯Œæ–¹æ¡ˆäº¤æ˜“å¸³ç°¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { -webkit-tap-highlight-color: transparent; font-family: -apple-system, sans-serif; background: #f1f5f9; }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .btn-primary { background: #1e293b; color: white; font-weight: 800; padding: 12px; border-radius: 12px; }
        .input-box { border: 1px solid #e2e8f0; border-radius: 8px; padding: 8px; width: 100%; background: #f8fafc; font-size: 14px; }
        .stock-tag { padding: 2px 8px; border-radius: 6px; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body class="p-4 pb-40">

    <div class="card p-6 mb-4 text-center">
        <p class="text-[10px] text-slate-400 font-bold tracking-widest mb-1 uppercase">ç¸½è³‡ç”¢åƒ¹å€¼ (M + R)</p>
        <h1 id="totalAssets" class="text-3xl font-black text-slate-800">NT$ 0</h1>
        <div id="ratioDisplay" class="text-[11px] mt-2 font-bold text-slate-500">M:R è¨ˆç®—ä¸­...</div>
    </div>

    <div class="grid grid-cols-3 gap-3 mb-4">
        <div class="card p-3">
            <p class="text-[10px] text-slate-400 font-bold mb-1">00631L å¸‚åƒ¹</p>
            <input type="number" id="curP631" class="input-box bg-yellow-50 text-amber-700" oninput="run()" value="265">
        </div>
        <div class="card p-3">
            <p class="text-[10px] text-slate-400 font-bold mb-1">QLD å¸‚åƒ¹</p>
            <input type="number" id="curPQLD" class="input-box bg-yellow-50 text-amber-700" oninput="run()" value="108">
        </div>
        <div class="card p-3">
            <p class="text-[10px] text-slate-400 font-bold mb-1">ä¿ç•™è³‡é‡‘ R(è¬)</p>
            <input type="number" id="rInput" class="input-box bg-green-50 text-green-700 font-black" oninput="run()" value="500">
        </div>
    </div>

    <div class="card p-4 mb-4 border-2 border-blue-100">
        <h2 class="text-sm font-black mb-3 text-slate-700">ğŸ†• æ–°å¢åŠ ç¢¼ç´€éŒ„</h2>
        <div class="grid grid-cols-2 gap-2 mb-2">
            <select id="newType" class="input-box">
                <option value="00631L">00631L (å°è‚¡)</option>
                <option value="QLD">QLD (ç¾è‚¡)</option>
            </select>
            <input type="number" id="newQty" class="input-box" placeholder="è²·å…¥è‚¡æ•¸">
        </div>
        <div class="grid grid-cols-2 gap-2 mb-3">
            <input type="number" id="newPrice" class="input-box" placeholder="æˆäº¤å–®åƒ¹">
            <button onclick="addTrade()" class="bg-blue-600 text-white font-black rounded-lg">æ–°å¢ç´€éŒ„</button>
        </div>
    </div>

    <h2 class="text-sm font-black mb-2 text-slate-600 px-1">ğŸ“œ æ­·å²åŠ ç¢¼æ¸…å–®</h2>
    <div id="tradeList" class="space-y-2 mb-6">
        </div>

    <div class="fixed bottom-4 left-4 right-4 space-y-2">
        <div class="grid grid-cols-2 gap-2 text-[10px] text-center mb-2">
            <div class="bg-white p-2 rounded-lg shadow">ç¾é‡‘åŒ¯ç‡: <input type="number" id="pRate" value="32.5" class="w-10 text-center" oninput="run()"></div>
            <button onclick="clearAll()" class="bg-red-50 text-red-400 rounded-lg shadow">æ¸…é™¤æ‰€æœ‰ç´€éŒ„</button>
        </div>
        <button onclick="calcBalance()" class="w-full btn-primary shadow-xl flex items-center justify-center gap-2">
            âš–ï¸ åŸ·è¡Œ M=R å¹³è¡¡å»ºè­°
        </button>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center p-6 z-50">
        <div class="bg-white rounded-3xl w-full p-6 shadow-2xl max-w-sm">
            <h3 class="font-black text-xl mb-4">âš–ï¸ ç­–ç•¥å¹³è¡¡å»ºè­°</h3>
            <div id="res" class="space-y-3"></div>
            <button onclick="document.getElementById('modal').classList.add('hidden')" class="w-full mt-6 bg-slate-800 text-white py-3 rounded-xl font-bold">é—œé–‰</button>
        </div>
    </div>

    <script>
        let trades = JSON.parse(localStorage.getItem('myTrades')) || [];

        function addTrade() {
            const type = document.getElementById('newType').value;
            const qty = parseFloat(document.getElementById('newQty').value);
            const price = parseFloat(document.getElementById('newPrice').value);
            if (!qty || !price) return alert("è«‹è¼¸å…¥è‚¡æ•¸èˆ‡å–®åƒ¹");

            trades.push({ id: Date.now(), type, qty, price, date: new Date().toLocaleDateString() });
            localStorage.setItem('myTrades', JSON.stringify(trades));
            
            document.getElementById('newQty').value = "";
            document.getElementById('newPrice').value = "";
            run();
        }

        function deleteTrade(id) {
            trades = trades.filter(t => t.id !== id);
            localStorage.setItem('myTrades', JSON.stringify(trades));
            run();
        }

        function clearAll() {
            if(confirm("ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰äº¤æ˜“ç´€éŒ„å—ï¼Ÿ")) {
                trades = [];
                localStorage.clear();
                location.reload();
            }
        }

        function run() {
            const curP631 = parseFloat(document.getElementById('curP631').value) || 0;
            const curPQLD = parseFloat(document.getElementById('curPQLD').value) || 0;
            const curRate = parseFloat(document.getElementById('pRate').value) || 32.5;
            const rVal = (parseFloat(document.getElementById('rInput').value) || 0) * 10000;
            
            localStorage.setItem('curP631', curP631);
            localStorage.setItem('curPQLD', curPQLD);
            localStorage.setItem('rInput', document.getElementById('rInput').value);

            let totalM631 = 0;
            let totalMQLD = 0;
            let listHtml = "";

            trades.forEach(t => {
                const is631 = t.type === "00631L";
                const currentPrice = is631 ? curP631 : curPQLD;
                const value = is631 ? (t.qty * currentPrice) : (t.qty * currentPrice * curRate);
                const cost = is631 ? (t.qty * t.price) : (t.qty * t.price * curRate);
                const profit = value - cost;
                const profitPct = ((profit/cost)*100).toFixed(1);

                if(is631) totalM631 += value; else totalMQLD += value;

                listHtml += `
                    <div class="card p-3 flex justify-between items-center border-l-4 ${is631 ? 'border-blue-500' : 'border-indigo-500'}">
                        <div>
                            <span class="stock-tag ${is631 ? 'bg-blue-100 text-blue-700' : 'bg-indigo-100 text-indigo-700'}">${t.type}</span>
                            <span class="text-xs font-bold text-slate-500 ml-2">${t.qty}è‚¡ @ ${t.price}</span>
                            <div class="text-[10px] text-slate-400">${t.date}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-black text-sm">NT$ ${Math.round(value).toLocaleString()}</div>
                            <div class="text-[10px] font-bold ${profit >= 0 ? 'text-red-500' : 'text-green-500'}">
                                ${profit >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(profitPct)}%
                            </div>
                        </div>
                        <button onclick="deleteTrade(${t.id})" class="ml-3 text-slate-300">âœ•</button>
                    </div>
                `;
            });

            document.getElementById('tradeList').innerHTML = listHtml || "<p class='text-center text-slate-400 py-4 text-xs'>å°šç„¡åŠ ç¢¼ç´€éŒ„</p>";
            
            const totalM = totalM631 + totalMQLD;
            const totalAssets = totalM + rVal;
            document.getElementById('totalAssets').innerText = "NT$ " + Math.round(totalAssets).toLocaleString();
            
            const mPct = totalAssets > 0 ? Math.round(totalM/totalAssets*100) : 0;
            document.getElementById('ratioDisplay').innerText = `M:R = ${mPct}:${100-mPct}% | ç¸½å¸‚å€¼ M: ${Math.round(totalM/10000)}è¬ / R: ${Math.round(rVal/10000)}è¬`;
        }

        function calcBalance() {
            const curP631 = parseFloat(document.getElementById('curP631').value) || 1;
            const curPQLD = parseFloat(document.getElementById('curPQLD').value) || 1;
            const curRate = parseFloat(document.getElementById('pRate').value) || 1;
            const rVal = (parseFloat(document.getElementById('rInput').value) || 0) * 10000;
            
            let s631 = 0, sQLD = 0;
            trades.forEach(t => { if(t.type==="00631L") s631 += t.qty; else sQLD += t.qty; });

            const totalM = (s631 * curP631) + (sQLD * curPQLD * curRate);
            const totalAssets = totalM + rVal;

            const targetAsset = totalAssets / 4;
            const targetR = totalAssets / 2;

            const d631 = (targetAsset / curP631) - s631;
            const dQLD = ((targetAsset / curRate) / curPQLD) - sQLD;
            const dR = (targetR - rVal) / 10000;

            document.getElementById('res').innerHTML = `
                <div class="bg-blue-50 p-3 rounded-lg"><p class="text-[10px] text-blue-500">00631L ç›®æ¨™</p><p class="font-black">${d631>=0?'è²·å…¥':'è³£å‡º'} ${Math.abs(Math.round(d631))} è‚¡</p></div>
                <div class="bg-indigo-50 p-3 rounded-lg"><p class="text-[10px] text-indigo-500">QLD ç›®æ¨™</p><p class="font-black">${dQLD>=0?'è²·å…¥':'è³£å‡º'} ${Math.abs(Math.round(dQLD))} è‚¡</p></div>
                <div class="bg-green-50 p-3 rounded-lg"><p class="text-[10px] text-green-500">ä¿ç•™è³‡é‡‘ R èª¿æ•´</p><p class="font-black">${dR>=0?'è£œå…¥':'æåˆ°'} ${Math.abs(Math.round(dR))} è¬å…ƒ</p></div>
            `;
            document.getElementById('modal').classList.remove('hidden');
        }

        window.onload = () => {
            document.getElementById('curP631').value = localStorage.getItem('curP631') || 265;
            document.getElementById('curPQLD').value = localStorage.getItem('curPQLD') || 108;
            document.getElementById('rInput').value = localStorage.getItem('rInput') || 500;
            run();
        };
    </script>
</body>
</html>
