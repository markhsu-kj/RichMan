<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‡´å¯Œæ–¹æ¡ˆ v6.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { -webkit-tap-highlight-color: transparent; font-family: -apple-system, sans-serif; background: #f1f5f9; }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .btn-primary { background: #1e293b; color: white; font-weight: 800; padding: 12px; border-radius: 12px; }
        .input-box { border: 1px solid #e2e8f0; border-radius: 8px; padding: 8px; width: 100%; background: #f8fafc; font-size: 14px; }
        .tab-active { background: #1e293b; color: white; }
        .tab-inactive { background: #e2e8f0; color: #64748b; }
    </style>
</head>
<body class="p-4 pb-44">

    <div class="flex justify-between items-center mb-2 px-1">
        <span class="text-[10px] font-black bg-blue-600 text-white px-2 py-1 rounded tracking-tighter">VERSION 6.2 è²·è³£å…¨åŠŸèƒ½ç‰ˆ</span>
        <span id="updateTime" class="text-[10px] text-slate-400 font-bold">2026 æˆ°ç•¥ä½ˆå±€</span>
    </div>

    <div class="card p-6 mb-4 text-center border-t-4 border-blue-600">
        <p class="text-[10px] text-slate-400 font-bold tracking-widest mb-1 uppercase">ç›®å‰ç¸½è³‡ç”¢æ·¨å€¼</p>
        <h1 id="totalAssets" class="text-3xl font-black text-slate-800 tracking-tighter">NT$ 0</h1>
        <div id="ratioDisplay" class="text-[11px] mt-2 font-bold text-slate-500 italic">è¨ˆç®—ä¸­...</div>
    </div>

    <div class="grid grid-cols-3 gap-3 mb-4">
        <div class="card p-3">
            <p class="text-[10px] text-slate-400 font-bold mb-1">00631L å¸‚åƒ¹</p>
            <input type="number" id="curP631" class="input-box bg-yellow-50 font-bold" oninput="run()">
        </div>
        <div class="card p-3">
            <p class="text-[10px] text-slate-400 font-bold mb-1">QLD å¸‚åƒ¹</p>
            <input type="number" id="curPQLD" class="input-box bg-yellow-50 font-bold" oninput="run()">
        </div>
        <div class="card p-3">
            <p class="text-[10px] text-slate-400 font-bold mb-1">æœ¬é‡‘ R(è¬)</p>
            <input type="number" id="rInput" class="input-box bg-green-50 text-green-700 font-black" oninput="run()">
        </div>
    </div>

    <div class="card p-4 mb-4 border-2 border-slate-200">
        <div class="flex gap-2 mb-3">
            <button id="btnBuy" onclick="setMode('buy')" class="flex-1 py-1 text-[10px] font-black rounded-full tab-active">è²·å…¥å…¥åº«</button>
            <button id="btnSell" onclick="setMode('sell')" class="flex-1 py-1 text-[10px] font-black rounded-full tab-inactive">è³£å‡ºæ¸›å€‰</button>
        </div>
        <div class="grid grid-cols-2 gap-2 mb-2">
            <select id="newType" class="input-box font-bold">
                <option value="00631L">00631L (å°è‚¡)</option>
                <option value="QLD">QLD (ç¾è‚¡)</option>
            </select>
            <input type="number" id="newQty" class="input-box" placeholder="è‚¡æ•¸">
        </div>
        <div class="grid grid-cols-2 gap-2 mb-1">
            <input type="number" id="newPrice" class="input-box" placeholder="æˆäº¤å–®åƒ¹">
            <button id="addBtn" onclick="addTrade()" class="bg-blue-600 text-white font-black rounded-lg active:scale-95 transition">ç¢ºèªæ–°å¢</button>
        </div>
    </div>

    <div class="flex justify-between items-center mb-2 px-1">
        <h2 class="text-sm font-black text-slate-600 italic">ğŸ“œ Transaction Logs</h2>
        <span id="recordCount" class="text-[10px] font-bold text-slate-400">0 records</span>
    </div>
    <div id="tradeList" class="space-y-2 mb-6"></div>

    <div class="fixed bottom-4 left-4 right-4 space-y-2">
        <div class="grid grid-cols-2 gap-2 text-[10px] text-center mb-2">
            <div class="bg-white p-2 rounded-xl shadow border border-slate-100 font-bold text-slate-500">
                USD/TWD: <input type="number" id="pRate" value="32.5" class="w-8 text-center text-blue-600" oninput="run()">
            </div>
            <button onclick="clearAll()" class="bg-white p-2 rounded-xl shadow border border-red-100 text-red-400 font-bold uppercase tracking-tighter">Reset Data</button>
        </div>
        <button onclick="calcBalance()" class="w-full btn-primary shadow-2xl py-4 flex items-center justify-center gap-2 active:scale-95 transition">
            âš–ï¸ åŸ·è¡Œ M=R æˆ°ç•¥å¹³è¡¡å»ºè­°
        </button>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/70 hidden items-center justify-center p-6 z-50 backdrop-blur-sm">
        <div class="bg-white rounded-3xl w-full p-6 shadow-2xl max-w-sm">
            <h3 class="font-black text-xl mb-4 text-slate-800">âš–ï¸ æˆ°ç•¥å¹³è¡¡å»ºè­°</h3>
            <div id="res" class="space-y-3"></div>
            <button onclick="document.getElementById('modal').classList.add('hidden')" class="w-full mt-6 bg-slate-800 text-white py-3 rounded-xl font-bold">äº†è§£ï¼ŒåŸ·è¡Œæ“ä½œ</button>
        </div>
    </div>

    <script>
        let trades = JSON.parse(localStorage.getItem('myTrades')) || [];
        let currentMode = 'buy';

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btnBuy').className = mode === 'buy' ? 'flex-1 py-1 text-[10px] font-black rounded-full tab-active' : 'flex-1 py-1 text-[10px] font-black rounded-full tab-inactive';
            document.getElementById('btnSell').className = mode === 'sell' ? 'flex-1 py-1 text-[10px] font-black rounded-full tab-active' : 'flex-1 py-1 text-[10px] font-black rounded-full tab-inactive';
            document.getElementById('addBtn').className = mode === 'buy' ? 'bg-blue-600 text-white font-black rounded-lg active:scale-95 transition' : 'bg-red-500 text-white font-black rounded-lg active:scale-95 transition';
        }

        function addTrade() {
            const type = document.getElementById('newType').value;
            let qty = parseFloat(document.getElementById('newQty').value);
            const price = parseFloat(document.getElementById('newPrice').value);
            if (!qty || !price) return alert("è«‹è¼¸å…¥å®Œæ•´è³‡æ–™");

            if(currentMode === 'sell') qty = -Math.abs(qty); // è³£å‡ºå­˜ç‚ºè² æ•¸

            trades.push({ id: Date.now(), type, qty, price, date: new Date().toLocaleDateString() });
            localStorage.setItem('myTrades', JSON.stringify(trades));
            
            document.getElementById('newQty').value = "";
            document.getElementById('newPrice').value = "";
            run();
        }

        function deleteTrade(id) {
            if(confirm("åˆªé™¤æ­¤ç´€éŒ„ï¼Ÿ")) {
                trades = trades.filter(t => t.id !== id);
                localStorage.setItem('myTrades', JSON.stringify(trades));
                run();
            }
        }

        function clearAll() {
            if(confirm("ç¢ºå®šæ¸…ç©ºæ‰€æœ‰æ•¸æ“šï¼Ÿ")) {
                trades = []; localStorage.clear(); location.reload();
            }
        }

        function run() {
            const curP631 = parseFloat(document.getElementById('curP631').value) || 0;
            const curPQLD = parseFloat(document.getElementById('curPQLD').value) || 0;
            const curRate = parseFloat(document.getElementById('pRate').value) || 32.5;
            const rVal = (parseFloat(document.getElementById('rInput').value) || 0) * 10000;
            
            localStorage.setItem('curP631', curP631);
            localStorage.setItem('curPQLD', curPQLD);
            localStorage.setItem('rInput', document.getElementById('rInput').value);

            let totalM631 = 0, totalMQLD = 0, s631Count = 0, sQLDCount = 0;
            let listHtml = "";

            trades.slice().reverse().forEach(t => {
                const is631 = t.type === "00631L";
                const isSell = t.qty < 0;
                if(is631) s631Count += t.qty; else sQLDCount += t.qty;

                const currentVal = is631 ? (t.qty * curP631) : (t.qty * curPQLD * curRate);
                if(is631) totalM631 += currentVal; else totalMQLD += currentVal;

                listHtml += `
                    <div class="card p-3 flex justify-between items-center border-l-4 ${isSell ? 'border-red-400 bg-red-50/20' : (is631 ? 'border-blue-500' : 'border-indigo-500')}">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span class="text-[9px] font-black px-1.5 py-0.5 rounded ${isSell ? 'bg-red-100 text-red-600' : (is631 ? 'bg-blue-100 text-blue-700' : 'bg-indigo-100 text-indigo-700')}">
                                    ${isSell ? 'SELL' : 'BUY'} ${t.type}
                                </span>
                                <span class="text-xs font-black text-slate-700">${Math.abs(t.qty).toLocaleString()} è‚¡</span>
                            </div>
                            <div class="text-[9px] text-slate-400 font-bold mt-1">æˆäº¤åƒ¹: ${t.price} / ${t.date}</div>
                        </div>
                        <div class="text-right mr-4">
                            <div class="font-black text-xs text-slate-600 italic">ä¼°å€¼ NT$ ${Math.round(Math.abs(currentVal)).toLocaleString()}</div>
                        </div>
                        <button onclick="deleteTrade(${t.id})" class="text-slate-300">âœ•</button>
                    </div>
                `;
            });

            document.getElementById('tradeList').innerHTML = listHtml || "<p class='text-center py-10 text-slate-400 text-xs font-bold'>No data available.</p>";
            document.getElementById('recordCount').innerText = `${trades.length} records`;
            
            const totalM = totalM631 + totalMQLD;
            const totalAssets = totalM + rVal;
            document.getElementById('totalAssets').innerText = "NT$ " + Math.round(totalAssets).toLocaleString();
            
            const mPct = totalAssets > 0 ? Math.round(totalM/totalAssets*100) : 0;
            document.getElementById('ratioDisplay').innerText = `Current M:R = ${mPct}:${100-mPct}% | æŒæœ‰è‚¡æ•¸: 631L(${Math.round(s631Count)}), QLD(${Math.round(sQLDCount)})`;
        }

        function calcBalance() {
            const curP631 = parseFloat(document.getElementById('curP631').value) || 1;
            const curPQLD = parseFloat(document.getElementById('curPQLD').value) || 1;
            const curRate = parseFloat(document.getElementById('pRate').value) || 1;
            const rVal = (parseFloat(document.getElementById('rInput').value) || 0) * 10000;
            
            let s631 = 0, sQLD = 0;
            trades.forEach(t => { if(t.type==="00631L") s631 += t.qty; else sQLD += t.qty; });

            const totalM = (s631 * curP631) + (sQLD * curPQLD * curRate);
            const totalAssets = totalM + rVal;
            const targetAsset = totalAssets / 4;
            const targetR = totalAssets / 2;

            const d631 = (targetAsset / curP631) - s631;
            const dQLD = ((targetAsset / curRate) / curPQLD) - sQLD;
            const dR = (targetR - rVal) / 10000;

            document.getElementById('res').innerHTML = `
                <div class="bg-blue-50 p-4 rounded-2xl border-l-4 border-blue-400">
                    <p class="text-[9px] text-blue-500 font-black">00631L å»ºè­°æ–¹å‘</p>
                    <p class="text-lg font-black">${d631>=0?'åŠ ç¢¼è³¼è²·':'æ¸›å€‰è³£å‡º'} ${Math.abs(Math.round(d631)).toLocaleString()} è‚¡</p>
                </div>
                <div class="bg-indigo-50 p-4 rounded-2xl border-l-4 border-indigo-400">
                    <p class="text-[9px] text-indigo-500 font-black">QLD å»ºè­°æ–¹å‘</p>
                    <p class="text-lg font-black">${dQLD>=0?'åŠ ç¢¼è³¼è²·':'æ¸›å€‰è³£å‡º'} ${Math.abs(Math.round(dQLD)).toLocaleString()} è‚¡</p>
                </div>
                <div class="bg-green-50 p-4 rounded-2xl border-l-4 border-green-400">
                    <p class="text-[9px] text-green-500 font-black">ç¾é‡‘ R èª¿æ•´</p>
                    <p class="text-lg font-black">${dR>=0?'æ‡‰è£œå…¥':'å¯æå–'} ${Math.abs(Math.round(dR))} è¬å…ƒ</p>
                </div>
            `;
            document.getElementById('modal').classList.remove('hidden');
        }

        window.onload = () => {
            document.getElementById('curP631').value = localStorage.getItem('curP631') || 265;
            document.getElementById('curPQLD').value = localStorage.getItem('curPQLD') || 108;
            document.getElementById('rInput').value = localStorage.getItem('rInput') || 500;
            run();
        };
    </script>
</body>
</html>
